<!DOCTYPE html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta charset="utf-8">
    <title>Guarantee - Design History - NCTS5</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#00938c"> 
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<link rel="shortcut icon" sizes="16x16 32x32 48x48" href="https://raw.githubusercontent.com/x-govuk/logo/main/images/x-govuk-favicon.ico" type="image/x-icon">
<link rel="mask-icon" href="https://raw.githubusercontent.com/x-govuk/logo/main/images/x-govuk-mask-icon.svg?raw=true" color="#00938c">
<link rel="apple-touch-icon" href="https://raw.githubusercontent.com/x-govuk/logo/main/images/x-govuk-apple-touch-icon.png">

<link rel="stylesheet" href="/assets/govuk.css">

<meta property="og:url" content="/">
<meta property="og:title" content="Guarantee">
<meta property="og:description" name="description" content="The new phase 5 trader details journey.">
    
    
    <meta property="og:image" content="/assets/opengraph-image.png">
  </head>
  <body class="govuk-template__body ">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

      <a href="#main-content" class="govuk-skip-link" data-module="govuk-skip-link">Skip to main content</a>


<header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-width-container app-header__container">
    <div class="govuk-header__logo app-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__logotype">
<!--[if gt IE 8]><!-->
<svg class="govuk-header__logotype-crown" aria-hidden="true" focusable="false" height="30" width="36" viewBox="0 0 132 97" xmlns="http://www.w3.org/2000/svg">
  <path fill="currentColor" fill-rule="evenodd" d="M25 30.2c3.5 1.5 7.7-.2 9.1-3.7 1.5-3.6-.2-7.8-3.9-9.2-3.6-1.4-7.6.3-9.1 3.9-1.4 3.5.3 7.5 3.9 9zM9 39.5c3.6 1.5 7.8-.2 9.2-3.7 1.5-3.6-.2-7.8-3.9-9.1-3.6-1.5-7.6.2-9.1 3.8-1.4 3.5.3 7.5 3.8 9zM4.4 57.2c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.5-1.5-7.6.3-9.1 3.8-1.4 3.5.3 7.6 3.9 9.1zm38.3-21.4c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.6-1.5-7.6.3-9.1 3.8-1.3 3.6.4 7.7 3.9 9.1zm64.4-5.6c-3.6 1.5-7.8-.2-9.1-3.7-1.5-3.6.2-7.8 3.8-9.2 3.6-1.4 7.7.3 9.2 3.9 1.3 3.5-.4 7.5-3.9 9zm15.9 9.3c-3.6 1.5-7.7-.2-9.1-3.7-1.5-3.6.2-7.8 3.7-9.1 3.6-1.5 7.7.2 9.2 3.8 1.5 3.5-.3 7.5-3.8 9zm4.7 17.7c-3.6 1.5-7.8-.2-9.2-3.8-1.5-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.3 3.5-.4 7.6-3.9 9.1zM89.3 35.8c-3.6 1.5-7.8-.2-9.2-3.8-1.4-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.4 3.6-.3 7.7-3.9 9.1zM69.7 17.7l8.9 4.7V9.3l-8.9 2.8c-.2-.3-.5-.6-.9-.9L72.4 0H59.6l3.5 11.2c-.3.3-.6.5-.9.9l-8.8-2.8v13.1l8.8-4.7c.3.3.6.7.9.9l-5 15.4v.1c-.2.8-.4 1.6-.4 2.4 0 4.1 3.1 7.5 7 8.1h.2c.3 0 .7.1 1 .1.4 0 .7 0 1-.1h.2c4-.6 7.1-4.1 7.1-8.1 0-.8-.1-1.7-.4-2.4V34l-5.1-15.4c.4-.2.7-.6 1-.9zM66 92.8c16.9 0 32.8 1.1 47.1 3.2 4-16.9 8.9-26.7 14-33.5l-9.6-3.4c1 4.9 1.1 7.2 0 10.2-1.5-1.4-3-4.3-4.2-8.7L108.6 76c2.8-2 5-3.2 7.5-3.3-4.4 9.4-10 11.9-13.6 11.2-4.3-.8-6.3-4.6-5.6-7.9 1-4.7 5.7-5.9 8-.5 4.3-8.7-3-11.4-7.6-8.8 7.1-7.2 7.9-13.5 2.1-21.1-8 6.1-8.1 12.3-4.5 20.8-4.7-5.4-12.1-2.5-9.5 6.2 3.4-5.2 7.9-2 7.2 3.1-.6 4.3-6.4 7.8-13.5 7.2-10.3-.9-10.9-8-11.2-13.8 2.5-.5 7.1 1.8 11 7.3L80.2 60c-4.1 4.4-8 5.3-12.3 5.4 1.4-4.4 8-11.6 8-11.6H55.5s6.4 7.2 7.9 11.6c-4.2-.1-8-1-12.3-5.4l1.4 16.4c3.9-5.5 8.5-7.7 10.9-7.3-.3 5.8-.9 12.8-11.1 13.8-7.2.6-12.9-2.9-13.5-7.2-.7-5 3.8-8.3 7.1-3.1 2.7-8.7-4.6-11.6-9.4-6.2 3.7-8.5 3.6-14.7-4.6-20.8-5.8 7.6-5 13.9 2.2 21.1-4.7-2.6-11.9.1-7.7 8.8 2.3-5.5 7.1-4.2 8.1.5.7 3.3-1.3 7.1-5.7 7.9-3.5.7-9-1.8-13.5-11.2 2.5.1 4.7 1.3 7.5 3.3l-4.7-15.4c-1.2 4.4-2.7 7.2-4.3 8.7-1.1-3-.9-5.3 0-10.2l-9.5 3.4c5 6.9 9.9 16.7 14 33.5 14.8-2.1 30.8-3.2 47.7-3.2z"></path>
</svg>
<!--<![endif]-->
<!--[if IE 8]>
<img src="/assets/images/govuk-logotype-crown.png" class="govuk-header__logotype-crown-fallback-image" width="36" height="32">
<![endif]-->
          <span class="govuk-header__logotype-text">
            NCTS5
          </span>
        </span>
        <span class="govuk-header__product-name">
          Design History
        </span>
      </a>
    </div>
    <div class="app-site-search govuk-!-display-none-print" data-module="app-site-search" data-search-index="/search.json">
  <label class="govuk-visually-hidden" for="app-site-search__input">Search site</label>
  <a class="app-site-search__link govuk-link-no-visited" href="/sitemap">Sitemap</a>
</div>

  </div>
</header>


      <div class="govuk-width-container ">
  <div class="govuk-breadcrumbs govuk-!-display-none-print">
  <ol class="govuk-breadcrumbs__list">
    <li class="govuk-breadcrumbs__list-item" aria-current="page"></li>
    <li class="govuk-breadcrumbs__list-item">
      <a class="govuk-breadcrumbs__link" href="/">NCTS5 Design History</a>
    </li>
    <li class="govuk-breadcrumbs__list-item">
      <a class="govuk-breadcrumbs__link" href="/histories/">Histories</a>
    </li>
    <li class="govuk-breadcrumbs__list-item" aria-current="page">Guarantee</li>
  </ol>
</div>

        <main class="govuk-main-wrapper " id="main-content" role="main">
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <header class="app-document-header">
  <h1 class="app-document-header__title govuk-heading-xl">
    Guarantee
  </h1>
</header>



      <footer class="app-document-footer">
  <p class="app-document-footer__metadata">
  </p>
</footer>

    </div>

    <div class="govuk-grid-column-two-thirds-from-desktop">
<div class="app-prose-scope">
        <h2 id="a-sub-journey" tabindex="-1" class="govuk-heading-l"><a class="app-heading-anchor" href="#a-sub-journey" class="govuk-link"><span>A sub-journey</span></a></h2>
<h4 id="the-dependencies" tabindex="-1" class="govuk-heading-s"><a class="app-heading-anchor" href="#the-dependencies" class="govuk-link"><span>The dependencies</span></a></h4>
<p class="govuk-body">This is new section which allows the users to provide information about the guarantees they might need or want to attach to their departure declarations.</p>
<p class="govuk-body">Users can view a list of different kind of guarantees, and add up to 9 per transit.</p>
<p class="govuk-body">The prototype includes an add/remove functionality in order to allow for more in depth research and testing.</p>
<h2 id="screenshots" tabindex="-1" class="govuk-heading-l"><a class="app-heading-anchor" href="#screenshots" class="govuk-link"><span>Screenshots</span></a></h2>
<p class="govuk-body"><img src="/assets/guarantee/01.png" alt="A screenshot" title="A screenshot of the guarantee sub-journey"><br>
<br></p>
<p class="govuk-body">The radio buttons lead to divergent paths in the rest of the user journey, this can be achieved in the <code class="x-govuk-code x-govuk-code--inline">routes.js</code> file.</p>
<pre class="x-govuk-code x-govuk-code--block x-govuk-code__language--js" tabindex="0"><code>router.<span class="x-govuk-code__title function_">post</span>(<span class="x-govuk-code__string">&quot;/guarantee-type&quot;</span>, <span class="x-govuk-code__keyword">function</span> (<span class="x-govuk-code__params">req, res</span>) {
  <span class="x-govuk-code__keyword">const</span> selectedGuarantee = req.<span class="x-govuk-code__property">session</span>.<span class="x-govuk-code__property">data</span>.<span class="x-govuk-code__property">guaranteeType</span>;

  <span class="x-govuk-code__keyword">const</span> guaranteeRadio = [
    <span class="x-govuk-code__string">&quot;(0) Guarantee waiver&quot;</span>,
    <span class="x-govuk-code__string">&quot;(1) Comprehensive guarantee&quot;</span>,
    <span class="x-govuk-code__string">&quot;(2) Individual guarantee&quot;</span>,
    <span class="x-govuk-code__string">&quot;(4) Flat-rate voucher redirect(guarantee-reference)&quot;</span>,
    <span class="x-govuk-code__string">&quot;(5) Guarantee waiver&quot;</span>,
    <span class="x-govuk-code__string">&quot;(9) Individual guarantee with multiple usage&quot;</span>,
    <span class="x-govuk-code__string">&quot;(J) Guarantee not required for the journey&quot;</span>,
  ];

  <span class="x-govuk-code__keyword">if</span> (guaranteeRadio.<span class="x-govuk-code__title function_">includes</span>(selectedGuarantee)) {
    res.<span class="x-govuk-code__title function_">redirect</span>(<span class="x-govuk-code__string">&quot;guarantee-reference&quot;</span>);
  } <span class="x-govuk-code__keyword">else</span> <span class="x-govuk-code__keyword">if</span> (
    selectedGuarantee == <span class="x-govuk-code__string">&quot;(8) Guarantee not required for certain public bodies&quot;</span>
  ) {
    res.<span class="x-govuk-code__title function_">redirect</span>(<span class="x-govuk-code__string">&quot;other-reference&quot;</span>);
  } <span class="x-govuk-code__keyword">else</span> <span class="x-govuk-code__keyword">if</span> (
    selectedGuarantee ==
    <span class="x-govuk-code__string">&quot;(3) Individual guarantee in cash or other means of payment&quot;</span>
  ) {
    res.<span class="x-govuk-code__title function_">redirect</span>(<span class="x-govuk-code__string">&quot;other-reference-cash-deposit&quot;</span>);
  } <span class="x-govuk-code__keyword">else</span> {
    res.<span class="x-govuk-code__title function_">redirect</span>(<span class="x-govuk-code__string">&quot;check-answers&quot;</span>);
  }
});

router.<span class="x-govuk-code__title function_">post</span>(<span class="x-govuk-code__string">&quot;/guarantee-type-xi&quot;</span>, <span class="x-govuk-code__keyword">function</span> (<span class="x-govuk-code__params">req, res</span>) {
  <span class="x-govuk-code__keyword">const</span> selectedGuarantee = req.<span class="x-govuk-code__property">session</span>.<span class="x-govuk-code__property">data</span>.<span class="x-govuk-code__property">guaranteeType</span>;

  <span class="x-govuk-code__keyword">const</span> guaranteeRadio = [
    <span class="x-govuk-code__string">&quot;(0) Guarantee waiver&quot;</span>,
    <span class="x-govuk-code__string">&quot;(1) Comprehensive guarantee&quot;</span>,
    <span class="x-govuk-code__string">&quot;(2) Individual guarantee&quot;</span>,
    <span class="x-govuk-code__string">&quot;(4) Flat-rate voucher redirect(guarantee-reference)&quot;</span>,
    <span class="x-govuk-code__string">&quot;(5) Guarantee waiver&quot;</span>,
    <span class="x-govuk-code__string">&quot;(J) Guarantee not required for the journey&quot;</span>,
  ];

  <span class="x-govuk-code__keyword">if</span> (guaranteeRadio.<span class="x-govuk-code__title function_">includes</span>(selectedGuarantee)) {
    res.<span class="x-govuk-code__title function_">redirect</span>(<span class="x-govuk-code__string">&quot;guarantee-reference&quot;</span>);
  } <span class="x-govuk-code__keyword">else</span> {
    <span class="x-govuk-code__keyword">let</span> guaranteeType = req.<span class="x-govuk-code__property">session</span>.<span class="x-govuk-code__property">data</span>.<span class="x-govuk-code__property">guaranteeType</span>;

    <span class="x-govuk-code__keyword">if</span> (
      guaranteeType == <span class="x-govuk-code__string">&quot;(8) Guarantee not required for certain public bodies&quot;</span>
    ) {
      res.<span class="x-govuk-code__title function_">redirect</span>(<span class="x-govuk-code__string">&quot;other-reference&quot;</span>);
    } <span class="x-govuk-code__keyword">else</span> <span class="x-govuk-code__keyword">if</span> (
      guaranteeType ==
      <span class="x-govuk-code__string">&quot;(3) Individual guarantee in cash or other means of payment&quot;</span>
    ) {
      res.<span class="x-govuk-code__title function_">redirect</span>(<span class="x-govuk-code__string">&quot;other-reference-cash-deposit&quot;</span>);
    } <span class="x-govuk-code__keyword">else</span> res.<span class="x-govuk-code__title function_">redirect</span>(<span class="x-govuk-code__string">&quot;check-answers&quot;</span>);
  }
});

router.<span class="x-govuk-code__title function_">post</span>(<span class="x-govuk-code__string">&quot;/guarantee-reference&quot;</span>, <span class="x-govuk-code__keyword">function</span> (<span class="x-govuk-code__params">req, res</span>) {
  <span class="x-govuk-code__keyword">const</span> selectedGuarantee2 = req.<span class="x-govuk-code__property">session</span>.<span class="x-govuk-code__property">data</span>.<span class="x-govuk-code__property">guaranteeType</span>;

  <span class="x-govuk-code__keyword">const</span> guaranteeRadio2 = [
    <span class="x-govuk-code__string">&quot;(0) Guarantee waiver&quot;</span>,
    <span class="x-govuk-code__string">&quot;(1) Comprehensive guarantee&quot;</span>,
    <span class="x-govuk-code__string">&quot;(2) Individual guarantee&quot;</span>,
    <span class="x-govuk-code__string">&quot;(4) Flat-rate voucher redirect(guarantee-reference)&quot;</span>,
    <span class="x-govuk-code__string">&quot;(9) Individual guarantee with multiple usage (for CTC only)&quot;</span>,
  ];

  <span class="x-govuk-code__keyword">if</span> (guaranteeRadio2.<span class="x-govuk-code__title function_">includes</span>(selectedGuarantee2)) {
    res.<span class="x-govuk-code__title function_">redirect</span>(<span class="x-govuk-code__string">&quot;access-code&quot;</span>);
  } <span class="x-govuk-code__keyword">else</span> {
    res.<span class="x-govuk-code__title function_">redirect</span>(<span class="x-govuk-code__string">&quot;check-answers&quot;</span>);
  }
});
</code></pre>

<p class="govuk-body"><img src="/assets/guarantee/02.png" alt="A screenshot" title="A screenshot of the guarantee sub-journey"><br>
<br></p>
<p class="govuk-body"><img src="/assets/guarantee/03.png" alt="A screenshot" title="A screenshot of the guarantee sub-journey"><br>
<br></p>
<p class="govuk-body"><img src="/assets/guarantee/04.png" alt="A screenshot" title="A screenshot of the guarantee sub-journey"><br>
<br></p>
<p class="govuk-body"><img src="/assets/guarantee/05.png" alt="A screenshot" title="A screenshot of the guarantee sub-journey"><br>
<br></p>
<p class="govuk-body"><img src="/assets/guarantee/06.png" alt="A screenshot" title="A screenshot of the guarantee sub-journey"><br>
<br></p>
<h4 id="the-add-another-feature" tabindex="-1" class="govuk-heading-s"><a class="app-heading-anchor" href="#the-add-another-feature" class="govuk-link"><span>The add another feature</span></a></h4>
<p class="govuk-body">At the end of the journey the user is presented with an option to add another guarantee to their declaration, this can go up to 9 different guarantees and then the user needs to remove one before adding another.</p>
<p class="govuk-body"><img src="/assets/guarantee/07.png" alt="A screenshot" title="A screenshot of the guarantee sub-journey"><br>
<br></p>
<h4 id="a-d.r.y-(a-do-not-repeat-yourself)" tabindex="-1" class="govuk-heading-s"><a class="app-heading-anchor" href="#a-d.r.y-(a-do-not-repeat-yourself)" class="govuk-link"><span>A D.R.Y (A Do not Repeat Yourself)</span></a></h4>
<p class="govuk-body">The code required to add and remove guarantees from the declaration. This code builds an array and indexes the guarantee, every time the user adds another guarantee, the maximum is set to nine. This code will be made part of every other add another pattern required through the prototype in the Routes, Transport, House Consignments and so on.</p>
<pre class="x-govuk-code x-govuk-code--block x-govuk-code__language--js" tabindex="0"><code>router.<span class="x-govuk-code__title function_">get</span>(<span class="x-govuk-code__string">&quot;/:index/remove-guarantee&quot;</span>, <span class="x-govuk-code__keyword">function</span> (<span class="x-govuk-code__params">req, res</span>) {
  res.<span class="x-govuk-code__title function_">render</span>(path.<span class="x-govuk-code__title function_">resolve</span>(__dirname, <span class="x-govuk-code__string">&quot;remove-guarantee&quot;</span>));
});

router.<span class="x-govuk-code__title function_">post</span>(<span class="x-govuk-code__string">&quot;/:index/remove-guarantee&quot;</span>, <span class="x-govuk-code__keyword">function</span> (<span class="x-govuk-code__params">req, res</span>) {
  <span class="x-govuk-code__keyword">let</span> removeGuarantee = req.<span class="x-govuk-code__property">session</span>.<span class="x-govuk-code__property">data</span>.<span class="x-govuk-code__property">removeGuarantee</span>;
  <span class="x-govuk-code__keyword">const</span> guarantees = req.<span class="x-govuk-code__property">session</span>.<span class="x-govuk-code__property">data</span>.<span class="x-govuk-code__property">guaranteeArray</span> || [];

  <span class="x-govuk-code__keyword">if</span> (removeGuarantee == <span class="x-govuk-code__string">&quot;Yes&quot;</span> &amp;&amp; guarantees.<span class="x-govuk-code__property">length</span>) {
    <span class="x-govuk-code__keyword">const</span> deleteIndex = req.<span class="x-govuk-code__property">params</span>.<span class="x-govuk-code__property">index</span> - <span class="x-govuk-code__number">1</span>;
    <span class="x-govuk-code__keyword">const</span> maxIndex = guarantees.<span class="x-govuk-code__property">length</span> || <span class="x-govuk-code__number">0</span>;

    <span class="x-govuk-code__keyword">if</span> (deleteIndex &lt;= maxIndex) {
      guarantees.<span class="x-govuk-code__title function_">splice</span>(deleteIndex, <span class="x-govuk-code__number">1</span>);

      req.<span class="x-govuk-code__property">session</span>.<span class="x-govuk-code__property">data</span>.<span class="x-govuk-code__property">guaranteeArray</span> = guarantees;
      req.<span class="x-govuk-code__property">session</span>.<span class="x-govuk-code__property">data</span>.<span class="x-govuk-code__property">guaranteeCount</span> = guarantees.<span class="x-govuk-code__property">length</span>;
    }
  }

  res.<span class="x-govuk-code__title function_">redirect</span>(<span class="x-govuk-code__string">&quot;../add-another-guarantee&quot;</span>);
});

router.<span class="x-govuk-code__title function_">get</span>(<span class="x-govuk-code__string">&quot;/:index/check-answers&quot;</span>, <span class="x-govuk-code__keyword">function</span> (<span class="x-govuk-code__params">req, res</span>) {
  <span class="x-govuk-code__keyword">const</span> data = req.<span class="x-govuk-code__property">session</span>.<span class="x-govuk-code__property">data</span>;
  <span class="x-govuk-code__keyword">const</span> index = <span class="x-govuk-code__built_in">parseInt</span>(req.<span class="x-govuk-code__property">params</span>.<span class="x-govuk-code__property">index</span>);
  <span class="x-govuk-code__keyword">const</span> guarantees = data.<span class="x-govuk-code__property">guaranteeArray</span> || [];

  <span class="x-govuk-code__keyword">if</span> (!guarantees.<span class="x-govuk-code__property">length</span>) {
    <span class="x-govuk-code__keyword">return</span> res.<span class="x-govuk-code__title function_">redirect</span>(<span class="x-govuk-code__string">&quot;../add-another-guarantee&quot;</span>);
  }

  <span class="x-govuk-code__keyword">const</span> guarantee = guarantees[req.<span class="x-govuk-code__property">params</span>.<span class="x-govuk-code__property">index</span> - <span class="x-govuk-code__number">1</span>] || {};

  req.<span class="x-govuk-code__property">session</span>.<span class="x-govuk-code__property">data</span> = {
    ...data,
    ...guarantee,
    <span class="x-govuk-code__attr">editGuarantee</span>: index,
  };

  res.<span class="x-govuk-code__title function_">redirect</span>(<span class="x-govuk-code__string">&quot;../check-answers&quot;</span>);
});

router.<span class="x-govuk-code__title function_">post</span>(<span class="x-govuk-code__string">&quot;/check-answers&quot;</span>, <span class="x-govuk-code__keyword">function</span> (<span class="x-govuk-code__params">req, res</span>) {
  <span class="x-govuk-code__keyword">const</span> data = req.<span class="x-govuk-code__property">session</span>.<span class="x-govuk-code__property">data</span>;
  <span class="x-govuk-code__keyword">const</span> guarantees = data.<span class="x-govuk-code__property">guaranteeArray</span> || [];

  <span class="x-govuk-code__keyword">const</span> guarantee = {
    <span class="x-govuk-code__attr">guaranteeType</span>: data.<span class="x-govuk-code__property">guaranteeType</span>,
    <span class="x-govuk-code__attr">guaranteeReference</span>: data.<span class="x-govuk-code__property">guaranteeReference</span>,
    <span class="x-govuk-code__attr">liabilityAmount</span>: data.<span class="x-govuk-code__property">liabilityAmount</span>,
    <span class="x-govuk-code__attr">accessCode</span>: <span class="x-govuk-code__string">&quot;****&quot;</span>,
  };

  <span class="x-govuk-code__keyword">if</span> (data.<span class="x-govuk-code__property">editGuarantee</span>) {
    guarantees[data.<span class="x-govuk-code__property">editGuarantee</span> - <span class="x-govuk-code__number">1</span>] = guarantee;
  } <span class="x-govuk-code__keyword">else</span> {
    guarantees.<span class="x-govuk-code__title function_">push</span>(guarantee);
    data.<span class="x-govuk-code__property">guaranteeArray</span> = guarantees;
    data.<span class="x-govuk-code__property">guaranteeCount</span> = guarantees.<span class="x-govuk-code__property">length</span>;
  }

  <span class="x-govuk-code__keyword">delete</span> data.<span class="x-govuk-code__property">editGuarantee</span>;

  res.<span class="x-govuk-code__title function_">redirect</span>(<span class="x-govuk-code__string">&quot;add-another-guarantee&quot;</span>);
});

router.<span class="x-govuk-code__title function_">post</span>(<span class="x-govuk-code__string">&quot;/add-another-guarantee-route&quot;</span>, <span class="x-govuk-code__keyword">function</span> (<span class="x-govuk-code__params">req, res</span>) {
  <span class="x-govuk-code__keyword">var</span> sessionData = req.<span class="x-govuk-code__property">session</span>.<span class="x-govuk-code__property">data</span>;
  <span class="x-govuk-code__keyword">var</span> guaranteeArray = sessionData.<span class="x-govuk-code__property">guaranteeArray</span> || [];
  <span class="x-govuk-code__keyword">var</span> guarantee = {
    <span class="x-govuk-code__attr">id</span>: guaranteeArray.<span class="x-govuk-code__property">length</span> + <span class="x-govuk-code__number">1</span>,
    <span class="x-govuk-code__attr">guarantee</span>: sessionData.<span class="x-govuk-code__property">guaranteeType</span>,
  };
  guaranteeArray.<span class="x-govuk-code__title function_">push</span>(guarantee);
  sessionData.<span class="x-govuk-code__property">guaranteeArray</span> = guaranteeArray;
  sessionData.<span class="x-govuk-code__property">guaranteeCount</span> = guaranteeArray.<span class="x-govuk-code__property">length</span>;
  res.<span class="x-govuk-code__title function_">redirect</span>(<span class="x-govuk-code__string">&quot;add-another-guarantee&quot;</span>);
});

router.<span class="x-govuk-code__title function_">post</span>(<span class="x-govuk-code__string">&quot;/guarantee-added-tir&quot;</span>, <span class="x-govuk-code__keyword">function</span> (<span class="x-govuk-code__params">req, res</span>) {
  res.<span class="x-govuk-code__title function_">redirect</span>(<span class="x-govuk-code__string">&quot;../task-list-3&quot;</span>);
});

router.<span class="x-govuk-code__title function_">post</span>(<span class="x-govuk-code__string">&quot;/add-another-guarantee&quot;</span>, <span class="x-govuk-code__keyword">function</span> (<span class="x-govuk-code__params">req, res</span>) {
  <span class="x-govuk-code__keyword">delete</span> req.<span class="x-govuk-code__property">session</span>.<span class="x-govuk-code__property">data</span>.<span class="x-govuk-code__property">editGuarantee</span>;

  <span class="x-govuk-code__keyword">if</span> (req.<span class="x-govuk-code__property">session</span>.<span class="x-govuk-code__property">data</span>.<span class="x-govuk-code__property">addAnotherGuarantee</span> == <span class="x-govuk-code__string">&quot;Yes&quot;</span>) {
    res.<span class="x-govuk-code__title function_">redirect</span>(<span class="x-govuk-code__string">&quot;guarantee-type&quot;</span>);
  } <span class="x-govuk-code__keyword">else</span> {
    res.<span class="x-govuk-code__title function_">redirect</span>(<span class="x-govuk-code__string">&quot;../task-list&quot;</span>);
  }
});

router.<span class="x-govuk-code__title function_">post</span>(<span class="x-govuk-code__string">&quot;/add-another-guarantee&quot;</span>, <span class="x-govuk-code__keyword">function</span> (<span class="x-govuk-code__params">req, res</span>) {
  <span class="x-govuk-code__keyword">delete</span> req.<span class="x-govuk-code__property">session</span>.<span class="x-govuk-code__property">data</span>.<span class="x-govuk-code__property">editGuarantee</span>;

  <span class="x-govuk-code__keyword">if</span> (req.<span class="x-govuk-code__property">session</span>.<span class="x-govuk-code__property">data</span>.<span class="x-govuk-code__property">guaranteeCount</span> == <span class="x-govuk-code__string">&quot;9&quot;</span>) {
    res.<span class="x-govuk-code__title function_">redirect</span>(<span class="x-govuk-code__string">&quot;../task-list&quot;</span>);
  } <span class="x-govuk-code__keyword">else</span> {
    res.<span class="x-govuk-code__title function_">redirect</span>(<span class="x-govuk-code__string">&quot;guarantee-type&quot;</span>);
  }
});
</code></pre>

<h4 id="the-declaration-summary" tabindex="-1" class="govuk-heading-s"><a class="app-heading-anchor" href="#the-declaration-summary" class="govuk-link"><span>The declaration summary</span></a></h4>
<p class="govuk-body">At the end of the journey the user is then taken back to the declaration summary where they can see that they have completed this section.</p>
<p class="govuk-body"><img src="/assets/guarantee/08.png" alt="A screenshot" title="A screenshot of the declaration summary"><br>
<br></p>

</div>
    </div>

      <div class="govuk-grid-column-one-third-from-desktop">

<aside class="app-aside">
  <h2 class="app-aside__heading">
    NCTS P5 prototype
  </h2>

  <div class="app-aside__body">
    <p class="govuk-body">Username:  prototype<br>
Password:  thisisabadpassword</p>
<p class="govuk-body">The Model is behind a VPN,<br>
only HMRC staff can access</p>

  </div>
</aside>

<div class="x-govuk-related-navigation">
    <nav class="x-govuk-related-navigation__nav-section" role="navigation" aria-labelledby="related-nav-related-content">
      <h2 class="x-govuk-related-navigation__main-heading" id="related-nav-related_items-related-content">
        Related content
      </h2>
        <ul class="x-govuk-related-navigation__link-list">
            <li class="x-govuk-related-navigation__link">
              <a class="govuk-link x-govuk-related-navigation__section-link x-govuk-related-navigation__section-link--other" href="https://ctc-trader-p5-prototype.herokuapp.com">Prototype link</a>
            </li>
            <li class="x-govuk-related-navigation__link">
              <a class="govuk-link x-govuk-related-navigation__section-link x-govuk-related-navigation__section-link--other" href="https://app.diagrams.net/#G15taz7Mp4fHI6uLJfiki2UtcY08oxmCby">Model link</a>
            </li>
        </ul>
    </nav>
</div>

      </div>
  </div>
        </main>
      </div>

<footer class="govuk-footer app-footer " role="contentinfo">
  <div class="govuk-width-container ">
    <div class="govuk-footer__meta">
      <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">
          <h2 class="govuk-visually-hidden">Support links</h2>
            <ul class="govuk-footer__inline-list">
                <li class="govuk-footer__inline-list-item">
                  <a class="govuk-footer__link" href="https://www.11ty.dev" target="_blank">
                    Documentation for Eleventy (opens in a new tab)
                  </a>
                </li>
            </ul>
          <span class="govuk-footer__licence-description">
            Licensed under the <a href="https://github.com/x-govuk/govuk-eleventy-plugin/blob/main/LICENSE.txt" class="govuk-footer__link">MIT Licence</a>, except where otherwise stated
          </span>
      </div>
      <div class="govuk-footer__meta-item">
        Â© X-GOVUK
      </div>
    </div>
  </div>
</footer>


<script src="/assets/govuk.js"></script>
<script>document.documentElement.classList.remove('no-js')</script>
  </body>
</html>
